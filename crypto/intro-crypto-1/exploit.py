from binascii import hexlify, unhexlify
from pwn import *

if __name__ == "__main__":
    c = connect("139813eb1288ad2e727ec658-1024-intro-crypto-1.challenge.cscg.live", 1337, ssl=True)
    known_plaintext = b"a" * (148//2)
    known_plaintext_bytes = hexlify(known_plaintext)
    c.sendline(known_plaintext_bytes)
    ciphertexts = []
    for i in range(255):
        ciphertext_bytes = c.recvline_contains("Ciphertext")
        ciphertext_line = ciphertext_bytes.decode()
        ciphertext = ciphertext_line.split(": ")[1].strip()
        ciphertexts.append(ciphertext)
    flag_bytes = c.recvline_contains("Flag")
    flag = flag_bytes.decode().split(": ")[1].strip()
    c.close()

    # decrypt flag
    for ciphertext in ciphertexts:
        ciphertext_bytes = ciphertext.encode()
        flag_bytes = flag.encode()
        decrypted = bytes(a1 ^ a2 ^ ord("a") for a1, a2 in zip(unhexlify(flag_bytes), unhexlify(ciphertext_bytes)))
        print(decrypted)



